@using Wherlog.Models.Post
@inject IJSRuntime JSRuntime
@inject NavigationManager Navigation

@if (Post != null)
{
    <FluentCard @onclick="() => OnClick(Post.Url)">
        <h3>@Post.Title</h3>
        @(new MarkupString(Post.Excerpt))
        <style>
            img.emoji {
                height: 18px;
                margin-bottom: -3px;
            }
            img[data-src] {
                visibility: collapse;
            }
            td.hljs-gutter {
                visibility: collapse;
            }
        </style>
    </FluentCard>
}

@code
{
    private IJSObjectReference _jsModule = default;

    [Parameter]
    public PostModel Post { get; set; }

    private void OnClick(string path)
    {
        Navigation.NavigateTo($"posts/{path}");
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // add highlight for any code blocks
            _jsModule = await JSRuntime.InvokeAsync<IJSObjectReference>("import", "./Layout/PostCard.razor.js");
            await _jsModule.InvokeVoidAsync("highlight");
            await _jsModule.InvokeVoidAsync("fixEmoji");
        }
    }
}
