@page "/pages/{*path}"
@using Wherlog.Helpers
@using Wherlog.Models
@using Wherlog.Models.Page
@inject NavigationManager Navigation

@if (pageModel == null)
{
    <PageTitle>Page</PageTitle>
    <h1>Page</h1>
    <FluentProgressRing />
}
else
{
    <PageTitle>@pageModel.Title</PageTitle>

    <div class="main-inner">
        <h1 class="post-title">@pageModel.Title</h1>
        <MarkdownSection Content="@((pageModel as IRaw).GetContent())" />
        @if (Path == "api")
        {
            <style>
                hgroup.main {
                    display: unset;
                }
            </style>
        }
    </div>
}

@code
{
    private RequestHelper request = RequestHelper.Default;
    private PageDetailModel pageModel;

    [Parameter]
    public string Path { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        Path = Path ?? "404";
        try
        {
            pageModel = await request.GetPageAsync(Path).GetResults();
        }
        catch
        {
            Navigation.NavigateTo("pages/404");
        }
    }
}
