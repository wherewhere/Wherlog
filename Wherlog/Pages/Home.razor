@page "/"
@using Wherlog.Helpers
@using Wherlog.Models
@using Wherlog.Models.Post

<PageTitle>Home</PageTitle>

<h1>Home</h1>

@if (postList  == null)
{
    <FluentProgressRing />
}
else
{
    <FluentStack Orientation="Orientation.Vertical">
        @foreach (PostModel post in postList)
        {
            <FluentCard>
                <h1>@post.Title</h1>
                <span style="white-space: pre-wrap;">@post.Excerpt</span>
            </FluentCard>
        }
    </FluentStack>
}

@code
{
    private RequestHelper request = RequestHelper.Default;
    private PostsModel postsIndex;
    private List<PostModel> postList = [];

    protected override async Task OnInitializedAsync()
    {
        postsIndex = await request.GetPostsAsync().ContinueWith(x => x.Result?.Data);
        foreach (IndexModel<InfoModel> index in postsIndex?.Pages)
        {
            postList.AddRange(await request.GetAsync(index.Api, SourceGenerationContext.Default.EntryPostsIndexModel).ContinueWith(x => x.Result.Data.Posts));
        }
    }
}
