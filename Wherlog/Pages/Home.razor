@page "/"
@using Wherlog.Helpers
@using Wherlog.Models
@using Wherlog.Models.Post

<PageTitle>Home</PageTitle>

<h1>Home</h1>

@if(@postList != null)
{
    @foreach (PostModel post in postList)
    {
        <FluentCard>
            <h1>@post.Title</h1>
            <p style="white-space: pre-wrap;">@post.Excerpt</p>
        </FluentCard>
    }
}

@code
{
    private RequestHelper request = RequestHelper.Default;
    private PostsModel postsIndex;
    private List<PostModel> postList = [];

    protected override async Task OnInitializedAsync()
    {
        postsIndex = await request.GetPostsAsync().ContinueWith(x => x.Result?.Data);
        foreach (IndexModel<InfoModel> index in postsIndex?.Pages)
        {
            postList.AddRange(await request.GetAsync<PostsIndexModel>(index.Api).ContinueWith(x => x.Result.Data.Posts));
        }
    }
}
